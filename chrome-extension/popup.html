<html>
  <script>

  function addFrame() {
var iframe = document.createElement("iframe");
iframe.setAttribute("src", "http://browser-timetracker.appspot.com/stats/view?now=" +
                            escape(new Date().getTime()/1000));
iframe.setAttribute("width", "400px");
iframe.setAttribute("height", "400px");
iframe.setAttribute("id", "stats_frame");
document.getElementById("stats").appendChild(iframe);
 }

 function sendStats() {
   chrome.extension.sendRequest({action: "sendStats"}, function(response) {
     /* Reload the iframe. */
     var iframe = document.getElementById("stats_frame");
     iframe.src = iframe.src;
   });
 }

 function clearStats() {
   chrome.extension.sendRequest({action: "clearStats"}, function(response) {
     /* Reload the iframe. */
     var iframe = document.getElementById("stats_frame");
     iframe.src = iframe.src;
   });
 }

 function togglePause() {
   console.log("In toggle pause");
   console.log("Value = " + localStorage["paused"]);
   if (localStorage["paused"] == "false") {
     console.log("Setting to Resume");
     localStorage["paused"] = "true";
     chrome.browserAction.setIcon({path: 'images/icon_paused.png'});
     document.getElementById("toggle_pause").innerHTML = "Resume Timer";
     } else if (localStorage["paused"] == "true"){
     console.log("Setting to Pause");
     localStorage["paused"] = "false";
     chrome.browserAction.setIcon({path: 'images/icon.png'});
     document.getElementById("toggle_pause").innerHTML = "Pause Timer";
   }
 }

 function initialize() {
   addFrame();

   var link = document.getElementById("toggle_pause");
   if (localStorage["paused"] == undefined || localStorage["paused"] == "false") {
     localStorage["paused"] = "false";
     link.innerHTML = "Pause Timer";
   } else {
     link.innerHTML = "Resume Timer";
   }
 }


  </script>
  <body onload="initialize()">

    <div id="options">
      <a href="javascript:void(0)" onclick="sendStats()">Send Stats</a>&nbsp;
      <a id="toggle_pause" href="javascript:void(0)"onclick="togglePause()"></a>&nbsp;
      <a href="javascript:void(0)" onclick="clearStats()">Clear *All* Stats</a>
    </div>
    <div id="stats"/>
  </body>
</html>
